<div *ngIf="vista === 'CARGANDO'" class="min-h-screen flex items-center justify-center bg-green-50">
  <div class="flex flex-col items-center gap-[1vw]">
    <svg class="animate-spin h-[4vw] w-[4vw] text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <p class="text-green-800 font-bold text-[1.5vw]">Verificando suscripci√≥n...</p>
  </div>
</div>

<section *ngIf="vista === 'YA_SOCIO'" class="min-h-screen pt-[7vw] flex items-center justify-center bg-green-50 px-[4vw]">
  <div class="bg-white rounded-[2vw] shadow-2xl p-[3vw] max-w-[55vw] w-full animate-fade-in-up text-center">
    
    <h1 class="text-[2.2vw] font-bold text-green-800 mb-[1vw]">
      üíö Hola, socio
    </h1>
    <p class="text-gray-600 text-[1.1vw] mb-[2vw]">
      Gracias por apoyar a CUDECA. Tu suscripci√≥n est√° <span class="text-green-600 font-bold">ACTIVA</span>.
    </p>

    <div class="bg-green-50 border border-green-200 rounded-[1.5vw] p-[2vw] mb-[2vw] text-left">
      <p class="text-green-800 font-semibold text-[1.1vw] mb-[0.8vw] border-b border-green-200 pb-[0.5vw]">
        Detalles de tu plan
      </p>
      <div class="text-gray-700 text-[1vw] flex flex-col gap-[0.8vw] mt-[0.8vw]">
        <div class="flex justify-between">
          <span>Plan actual:</span>
          <span class="font-bold text-green-900 capitalize">{{ datosSocio?.plan || 'Est√°ndar' }}</span>
        </div>
        <div class="flex justify-between" *ngIf="datosSocio?.fechaFin">
          <span>Pr√≥xima renovaci√≥n:</span>
          <span class="font-bold text-green-900">{{ datosSocio?.fechaFin | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="flex justify-between text-[0.9vw] text-gray-500" *ngIf="datosSocio?.diasRestantes">
          <span>D√≠as restantes:</span>
          <span>{{ datosSocio?.diasRestantes }} d√≠as</span>
        </div>
      </div>
    </div>

    <button (click)="renovar()"
      class="w-full bg-green-600 hover:bg-green-800 text-white font-bold py-[1vw] rounded-[1vw] transition-transform hover:scale-[1.02] text-[1.1vw]">
      Cambiar mi plan
    </button>
    <button (click)="volverHome()"
      class="w-full mt-[1vw] bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-[0.9vw] rounded-[1vw] text-[1.1vw]">
      Volver al inicio
    </button>
  </div>
</section>

<section *ngIf="vista === 'SELECCION'" class="relative w-full bg-green-50 font-sans pt-[10vw] pb-[6vw] px-[4vw] overflow-hidden min-h-screen">
  
  <img src="assets/images/fondoCudeca.png" class="absolute inset-0 w-full h-full object-cover z-0" />
  <div class="absolute inset-0 bg-green-400/30 z-10"></div>

  <div class="relative z-20 flex items-center justify-center min-h-[calc(100vh-20vw)]">
    <div class="bg-white rounded-[2.5vw] shadow-2xl p-[3vw] max-w-[65vw] w-full animate-fade-in-up">

      <h1 class="text-[2.2vw] font-bold text-green-800 mb-[0.8vw] text-center">
        Hazte socio de CUDECA
      </h1>
      <p class="text-gray-600 text-[1.1vw] mb-[2.5vw] text-center">
        Tu apoyo permite que sigamos cuidando a quienes m√°s lo necesitan.
      </p>

      <div class="grid grid-cols-3 gap-[1.5vw] mb-[3vw]">
        <div class="bg-green-50 rounded-[1.2vw] p-[1.6vw] text-center hover:scale-105 transition-transform">
          <div class="text-[2vw] mb-[0.6vw]">üéüÔ∏è</div>
          <p class="font-semibold text-green-800 text-[1vw]">Descuentos en eventos</p>
        </div>
        <div class="bg-green-50 rounded-[1.2vw] p-[1.6vw] text-center hover:scale-105 transition-transform">
          <div class="text-[2vw] mb-[0.6vw]">‚≠ê</div>
          <p class="font-semibold text-green-800 text-[1vw]">Acceso prioritario</p>
        </div>
        <div class="bg-green-50 rounded-[1.2vw] p-[1.6vw] text-center hover:scale-105 transition-transform">
          <div class="text-[2vw] mb-[0.6vw]">üíö</div>
          <p class="font-semibold text-green-800 text-[1vw]">Apoyo directo</p>
        </div>
      </div>

      <div class="grid grid-cols-3 gap-[1.5vw] mb-[3vw]">
        
        <button (click)="seleccionarPlan('mensual', 10)"
          class="border-2 rounded-[1.2vw] p-[1.5vw] text-center transition-all duration-300 group"
          [ngClass]="planSeleccionado === 'mensual' 
             ? 'bg-green-600 border-green-600 text-white shadow-lg scale-105' 
             : 'bg-white border-gray-200 hover:border-green-500 hover:bg-green-50'">
          
          <div class="text-[1.2vw] font-semibold"
               [ngClass]="planSeleccionado === 'mensual' ? 'text-white' : 'text-gray-800 group-hover:text-green-700'">
               Mensual
          </div>
          <div class="text-[1.8vw] font-bold mt-[0.5vw]">10 ‚Ç¨</div>
        </button>

        <button (click)="seleccionarPlan('trimestral', 25)"
          class="border-2 rounded-[1.2vw] p-[1.5vw] text-center transition-all duration-300 group relative overflow-hidden"
          [ngClass]="planSeleccionado === 'trimestral' 
             ? 'bg-green-600 border-green-600 text-white shadow-lg scale-105' 
             : 'bg-white border-gray-200 hover:border-green-500 hover:bg-green-50'">
          
          <div class="absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-[0.7vw] font-bold px-[1vw] py-[0.2vw] rounded-bl-lg z-10">
            POPULAR
          </div>

          <div class="text-[1.2vw] font-semibold"
               [ngClass]="planSeleccionado === 'trimestral' ? 'text-white' : 'text-gray-800 group-hover:text-green-700'">
               Trimestral
          </div>
          <div class="text-[1.8vw] font-bold mt-[0.5vw]">25 ‚Ç¨</div>
          <div class="text-[0.8vw] mt-[0.5vw]"
               [ngClass]="planSeleccionado === 'trimestral' ? 'text-green-100' : 'text-gray-500'">
               Ahorras 5‚Ç¨ al a√±o
          </div>
        </button>

        <button (click)="seleccionarPlan('anual', 90)"
          class="border-2 rounded-[1.2vw] p-[1.5vw] text-center transition-all duration-300 group"
          [ngClass]="planSeleccionado === 'anual' 
             ? 'bg-green-600 border-green-600 text-white shadow-lg scale-105' 
             : 'bg-white border-gray-200 hover:border-green-500 hover:bg-green-50'">
          
          <div class="text-[1.2vw] font-semibold"
               [ngClass]="planSeleccionado === 'anual' ? 'text-white' : 'text-gray-800 group-hover:text-green-700'">
               Anual
          </div>
          <div class="text-[1.8vw] font-bold mt-[0.5vw]">90 ‚Ç¨</div>
          <div class="text-[0.8vw] mt-[0.5vw]"
               [ngClass]="planSeleccionado === 'anual' ? 'text-green-100' : 'text-gray-500'">
               Ahorras 30‚Ç¨ al a√±o
          </div>
        </button>
      </div>

      <button (click)="irAResumen()" 
        [disabled]="!planSeleccionado"
        class="w-full bg-green-600 text-white font-bold py-[1.2vw] rounded-[1.2vw] hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-[1.2vw] shadow-md">
        Continuar
      </button>

      <p *ngIf="errorMessage" class="text-red-600 mt-[1.2vw] text-center text-[1vw] animate-pulse">
        {{ errorMessage }}
      </p>

      <button (click)="cancelarSeleccion()" 
        class="w-full mt-[1vw] bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-[0.9vw] rounded-[1vw] text-[1vw] transition-colors">
          Volver
      </button>

      

      <p *ngIf="errorMessage" class="text-red-600 mt-[1.2vw] text-center text-[1vw] animate-pulse">
        {{ errorMessage }}
      </p>

      <button *ngIf="!datosSocio" (click)="volverHome()" class="w-full mt-[1vw] text-gray-500 hover:text-gray-700 text-[1vw]">
          Cancelar y volver al inicio
      </button>
    </div>
  </div>
</section>

<section *ngIf="vista === 'RESUMEN'" class="w-full min-h-screen pt-[10vw] pb-[4vw] bg-green-50 relative font-sans">
  
  <img src="assets/images/fondoCudeca.png" class="absolute inset-0 w-full h-full object-cover -z-10" />
  <div class="absolute inset-0 bg-green-400/30 -z-5"></div>

  <div class="max-w-[70vw] mx-auto relative z-10">
    <div class="bg-white rounded-[2vw] shadow-2xl p-[3vw] animate-fade-in-up">

      <div class="text-center mb-[2.5vw]">
        <h1 class="text-[2.2vw] font-bold text-green-800 mb-[0.8vw]">
          Resumen de tu aportaci√≥n üíö
        </h1>
        <p class="text-gray-600 text-[1.1vw]">
          Est√°s a un paso de unirte a nuestra familia solidaria.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-[2.5vw]">
        <div class="lg:col-span-1 bg-green-50 border border-green-200 rounded-[1.5vw] p-[2vw]">
          <h3 class="text-[1.3vw] font-bold text-green-800 mb-[1.2vw]">Detalle</h3>
          <div class="mb-[1.5vw]">
            <p class="text-gray-600 text-[0.95vw]">Plan seleccionado</p>
            <p class="text-green-900 font-bold text-[1.3vw] capitalize">{{ planSeleccionado }}</p>
          </div>
          <div class="bg-white rounded-[1vw] p-[1.2vw] shadow-sm border border-gray-100">
            <p class="text-gray-600 text-[0.95vw] mb-[0.3vw]">Total a pagar ahora</p>
            <p class="text-green-900 font-bold text-[1.8vw]">{{ precioSeleccionado }} ‚Ç¨</p>
          </div>
        </div>

        <div class="lg:col-span-2 flex flex-col justify-between">
          <div class="mb-[2vw]">
            <h3 class="text-[1.4vw] font-bold text-green-700 mb-[1.2vw]">
              ¬øQu√© incluye tu suscripci√≥n?
            </h3>
            <ul class="grid grid-cols-2 gap-[1.2vw] text-[1vw] text-gray-700">
              <li class="flex gap-[0.6vw] items-center">
                 <span class="text-green-500">‚úì</span><span>Apoyo continuo a pacientes</span>
              </li>
              <li class="flex gap-[0.6vw] items-center">
                 <span class="text-green-500">‚úì</span><span>Certificado de colaboraci√≥n</span>
              </li>
              <li class="flex gap-[0.6vw] items-center">
                 <span class="text-green-500">‚úì</span><span>Deducci√≥n fiscal</span>
              </li>
              <li class="flex gap-[0.6vw] items-center">
                 <span class="text-green-500">‚úì</span><span>Comunidad CUDECA</span>
              </li>
            </ul>
          </div>

          <div class="flex flex-col gap-[1vw]">
            <button (click)="confirmarYPagar()" 
              [disabled]="isProcessing"
              class="w-full bg-green-600 hover:bg-green-800 text-white font-bold py-[1vw] rounded-[1vw] transition-transform hover:scale-[1.02] shadow-lg text-[1.2vw] flex justify-center items-center">
              
              <span *ngIf="!isProcessing">Ir al pago seguro</span>
              
              <span *ngIf="isProcessing" class="flex items-center gap-[0.5vw]">
                 <svg class="animate-spin h-[1.2vw] w-[1.2vw] text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                 Procesando...
              </span>
            </button>

            <button (click)="volverASeleccion()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-[0.9vw] rounded-[1vw] text-[1vw]">
              Volver atr√°s
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</section>