<section class="min-h-screen bg-gray-200 py-[5vw] px-[4vw] pt-[10vw] font-sans">

  

  <div *ngIf="loadingPerfil" class="flex flex-col items-center justify-center h-[60vh]">
    <div class="animate-spin rounded-full h-[5vw] w-[5vw] border-b-[0.4vw] border-green-600 mb-[2vw]"></div>
    <p class="text-green-800 text-[1.5vw] font-bold">Cargando tu perfil...</p>
  </div>


  <div *ngIf="!loadingPerfil" class="animate-fade-in">
    
    <div class="max-w-[80vw] mx-auto mb-[3vw] flex justify-between items-center">
      <div>
        <h1 class="text-[3vw] font-bold text-green-900">
          Hola, {{ usuario.nombre || (usuario.email ? usuario.email.split('@')[0] : 'Socio') }} üëã
        </h1>
        <p class="text-gray-600 text-[1.2vw]">Bienvenido a tu √°rea personal</p>
      </div>
      
      <button *ngIf="vistaActual !== 'menu'" (click)="cambiarVista('menu')" 
              class="text-green-700 font-bold hover:underline text-[1.2vw]">
        ‚Üê Volver al men√∫
      </button>
    </div>

    <!-- Menu -->

    <div *ngIf="vistaActual === 'menu'" class="max-w-[80vw] mx-auto grid grid-cols-1 md:grid-cols-2 gap-[2vw]">
      
      <div (click)="cambiarVista('perfil')" class="bg-white p-[2vw] rounded-[1.5vw] shadow-md hover:shadow-xl transition cursor-pointer border-l-[0.5vw] border-blue-500 group">
        <h3 class="text-[1.5vw] font-bold text-gray-800 group-hover:text-blue-600">üë§ Mis Datos Personales</h3>
        <p class="text-gray-500 mt-[0.5vw] text-[1vw]">Ver y modificar tu nombre, DNI, tel√©fono...</p>
      </div>

      <div (click)="cambiarVista('tickets')" class="bg-white p-[2vw] rounded-[1.5vw] shadow-md hover:shadow-xl transition cursor-pointer border-l-[0.5vw] border-purple-500 group">
        <h3 class="text-[1.5vw] font-bold text-gray-800 group-hover:text-purple-600">üéüÔ∏è Mis Entradas</h3>
        <p class="text-gray-500 mt-[0.5vw] text-[1vw]">Consulta los eventos a los que te has apuntado.</p>
      </div>

      <div (click)="cambiarVista('donaciones')" class="bg-white p-[2vw] rounded-[1.5vw] shadow-md hover:shadow-xl transition cursor-pointer border-l-[0.5vw] border-green-500 group">
        <h3 class="text-[1.5vw] font-bold text-gray-800 group-hover:text-green-600">‚ù§Ô∏è Mi Historial Solidario</h3>
        <p class="text-gray-500 mt-[0.5vw] text-[1vw]">Consulta tus donaciones y el total aportado.</p>
      </div>

      <div (click)="onLogout()" class="bg-red-50 p-[2vw] rounded-[1.5vw] shadow-md hover:bg-red-100 transition cursor-pointer border-l-[0.5vw] border-red-500 group">
        <h3 class="text-[1.5vw] font-bold text-red-700">‚ùå Cerrar Sesi√≥n</h3>
        <p class="text-red-500 mt-[0.5vw] text-[1vw]">Salir de tu cuenta de forma segura.</p>
      </div>
    </div>

    <!-- SECCI√ìN PERFIL -->

    <div *ngIf="vistaActual === 'perfil'" class="max-w-[50vw] mx-auto bg-white p-[3vw] rounded-[2vw] shadow-lg">
      <h3 class="text-[2vw] font-bold text-gray-800 mb-[2vw]">Mis Datos</h3>
      <form (ngSubmit)="guardarCambios()" class="space-y-[1.5vw]">
        
        <div>
          <label class="block text-gray-700 font-bold text-[1vw] mb-[0.5vw]">Nombre</label>
          <input [(ngModel)]="usuario.nombre" name="nombre" type="text" class="w-full p-[0.8vw] text-[0.8vw] border rounded-[0.5vw] bg-gray-50">
        </div>
        
        <div>
          <label class="block text-gray-700 font-bold text-[1vw] mb-[0.5vw]">Apellidos</label>
          <input [(ngModel)]="usuario.apellidos" name="apellidos" type="text" class="w-full p-[0.8vw] text-[0.8vw] border rounded-[0.5vw] bg-gray-50">
        </div>

        <div>
          <label class="block text-gray-700 font-bold text-[1vw] mb-[0.5vw]">DNI / NIF</label>
          <input [(ngModel)]="usuario.dni" name="dni" type="text" class="w-full p-[0.8vw] text-[0.8vw] border rounded-[0.5vw] bg-gray-50">
        </div>

        <div>
          <label class="block text-gray-700 font-bold text-[1vw] mb-[0.5vw]">Tel√©fono</label>
          <input [(ngModel)]="usuario.telefono" name="telefono" type="tel" class="w-full p-[0.8vw] text-[0.8vw] border rounded-[0.5vw] bg-gray-50">
        </div>

        <button type="submit" [disabled]="isLoading" class="w-full bg-blue-600 text-white text-[1.2vw] font-bold py-[1vw] rounded-[0.5vw] hover:bg-blue-700 transition">
          {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
        </button>
      </form>
    </div>

    <!-- SECCI√ìN TICKETS -->

    <div *ngIf="vistaActual === 'tickets'" class="max-w-[60vw] mx-auto">
      <h3 class="text-[2vw] font-bold text-purple-800 mb-[2vw]">Mis Entradas</h3>
      
      <div *ngIf="tickets.length === 0" class="text-center text-[1vw] text-gray-500 bg-white p-[3vw] rounded-[1vw]">
        <p>No has adquirido ninguna entrada a√∫n. ¬°Ap√∫ntate a un evento!</p>
      </div>

      <div class="grid gap-[1.5vw]">
        <div *ngFor="let ticket of tickets" class="bg-white p-[1.5vw] rounded-[1vw] shadow border-l-4 border-purple-500 flex justify-between items-center">
          <div>
            <h3 class="font-bold text-[1.2vw]">{{ ticket.eventoTitulo || 'Evento' }}</h3>
            <p class="text-gray-500">{{ ticket.fechaCompra | date:'shortDate' }}</p>
          </div>
          <span class="bg-purple-100 text-purple-800 px-[1vw] py-[0.5vw] rounded-full text-[0.9vw] font-bold">
            Confirmada
          </span>
        </div>
      </div>
    </div>

    <!-- SECCI√ìN DONACIONES -->

    <div *ngIf="vistaActual === 'donaciones'" class="max-w-[60vw] mx-auto">
      
      <div class="bg-green-600 text-white p-[2vw] rounded-[1.5vw] shadow-lg mb-[2vw] flex justify-between items-center">
        <div>
          <h3 class="text-[1.5vw] font-medium opacity-90">Total Donado</h3>
          <p class="text-[3vw] font-bold">{{ totalDonado | currency:'EUR' }}</p>
        </div>
        <div class="text-[4vw]">‚ù§Ô∏è</div>
      </div>

      <h3 class="text-[1.5vw] font-bold text-gray-800 mb-[1vw]">Historial</h3>
      
      <div *ngIf="donaciones.length === 0" class="text-center text-gray-500 bg-white p-[3vw] rounded-[1vw]">
        <p>A√∫n no has realizado donaciones.</p>
      </div>

      <div class="bg-white rounded-[1vw] overflow-hidden shadow">
        <table class="w-full text-left">
          <thead class="bg-gray-100 text-gray-600 uppercase text-[0.8vw]">
            <tr>
              <th class="p-[1vw]">Fecha</th>
              <th class="p-[1vw]">Concepto</th>
              <th class="p-[1vw] text-right">Cantidad</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let donacion of donaciones">
              <td class="p-[1vw] text-[0.8vw] text-gray-600">{{ donacion.fecha | date:'shortDate' }}</td>
              <td class="p-[1vw] text-[0.8vw] font-medium">{{ donacion.concepto || 'Donaci√≥n puntual' }}</td>
              <td class="p-[1vw] text-[0.8vw] text-right font-bold text-green-600">{{ donacion.amount || donacion.cantidad | currency:'EUR' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>