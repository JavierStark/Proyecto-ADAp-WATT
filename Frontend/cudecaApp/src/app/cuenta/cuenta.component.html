<section class="relative w-full min-h-screen bg-green-50 overflow-hidden">
  

  <!-- Filtro verde semitransparente -->
  <div class="absolute inset-0 bg-green-400 opacity-30 z-0"></div>

  <!-- Contenido principal -->
  <div class="relative z-10 pb-[4vh] pt-[6vw] px-[4vw] flex flex-col items-center justify-center min-h-screen">
    
    <!-- Spinner de carga -->
    <div *ngIf="loadingPerfil" class="flex flex-col items-center justify-center py-[10vh]">
      <div class="animate-spin rounded-full h-[4vw] w-[4vw] border-b-4 border-green-900 mb-[2vh]"></div>
      <p class="text-green-900 text-[1.2vw] font-bold">Cargando tu perfil...</p>
    </div>

    <!-- Contenido cuando carga -->
    <div *ngIf="!loadingPerfil" class="w-full">

      <!-- MEN√ö PRINCIPAL -->
      <div *ngIf="vistaActual === 'menu'" class="flex flex-col items-center justify-center gap-[2vh] max-w-[35vw] mx-auto">
        
        <div class="flex flex-col items-center gap-[1vw] mb-[2vh]">
          <h1 class="text-green-900 text-[3vw] font-bold text-center leading-tight">
            Hola, {{ usuario.nombre || (usuario.email ? usuario.email.split('@')[0] : 'Socio') }} üëã
          </h1>
          
          <span *ngIf="isSocio" 
                class="bg-green-100 text-green-700 text-[1vw] md:text-[0.8vw] font-bold px-[1.2vw] py-[0.4vw] rounded-full border border-green-200 shadow-sm uppercase tracking-wide">
            ‚≠ê Socio Activo
          </span>
        </div>


        <!-- Bot√≥n Mis Datos (borde verde, relleno blanco) -->
        <button 
          (click)="cambiarVista('perfil')"
          class="w-full bg-white text-green-700 text-[1.5vw] font-bold py-[1.2vw] px-[2vw] rounded-[1.5vw] border-2 border-green-600 hover:bg-green-50 transition">
          Mis datos
        </button>

        <!-- Bot√≥n Mis Entradas (relleno verde) -->
        <button 
          (click)="cambiarVista('tickets')"
          class="w-full bg-green-600 text-white text-[1.5vw] font-bold py-[1.2vw] px-[2vw] rounded-[1.5vw] hover:bg-green-700 transition">
          Mis entradas
        </button>

        <!-- Bot√≥n Mis Donaciones (relleno verde) -->
        <button 
          (click)="cambiarVista('donaciones')"
          class="w-full bg-green-600 text-white text-[1.5vw] font-bold py-[1.2vw] px-[2vw] rounded-[1.5vw] hover:bg-green-700 transition">
          Mis donaciones
        </button>

        <!-- Bot√≥n Cerrar Sesi√≥n (relleno verde) -->
        <button 
          (click)="onLogout()"
          class="w-full bg-green-600 text-white text-[1.5vw] font-bold py-[1.2vw] px-[2vw] rounded-[1.5vw] hover:bg-green-700 transition">
          Cerrar sesi√≥n
        </button>
      </div>

      <!-- VISTA PERFIL -->
      <div *ngIf="vistaActual === 'perfil'" class="flex flex-col pt-[4vw] items-center justify-center">
        
        <!-- Contenedor principal -->
        <div class="bg-white rounded-[2vw] shadow-lg p-[3vw] max-w-[60vw] w-full">
          
          <!-- Grid: Foto + Datos -->
          <div class="grid grid-cols-2 gap-[3vw] mb-[2vw]">
            
            <!-- Foto (izquierda) -->
            <div class="flex items-center justify-center">
              <div class="w-[18vw] h-[18vw] rounded-[1.5vw] border-3 border-green-600 bg-green-100 flex items-center justify-center">
                <span class="text-green-600 text-[3vw] font-light">FOTO</span>
              </div>
            </div>

            <!-- Datos (derecha) -->
            <div class="space-y-[1vh] text-[1vw] text-gray-800 font-medium">
              <p><strong>Nombre:</strong> {{ usuario.nombre || '___________________' }}</p>
              <p><strong>Apellidos:</strong> {{ usuario.apellidos || '___________________' }}</p>
              <p><strong>Correo electr√≥nico:</strong> {{ usuario.email || '___________________' }}</p>
              <p><strong>Tel√©fono:</strong> {{ usuario.telefono || '___________________' }}</p>
              <p><strong>DNI / Identificaci√≥n:</strong> {{ usuario.dni || '___________________' }}</p>
              <p><strong>Calle:</strong> {{ usuario.calle || '___________________' }}</p>
              <p><strong>N√∫mero:</strong> {{ usuario.numero || '___________________' }}</p>
              <p><strong>Piso/Puerta:</strong> {{ usuario.pisoPuerta || '___________________' }}</p>
              <p><strong>C√≥digo Postal:</strong> {{ usuario.codigoPostal || '___________________' }}</p>
              <p><strong>Ciudad:</strong> {{ usuario.ciudad || '___________________' }}</p>
              <p><strong>Provincia:</strong> {{ usuario.provincia || '___________________' }}</p>
              <p><strong>Pa√≠s:</strong> {{ usuario.pais || '___________________' }}</p>
            </div>
          </div>

          <!-- Bot√≥n Editar Datos -->
          <div class="flex justify-center">
            <button 
              (click)="entrarModoEdicion()"
              class="bg-green-600 text-white text-[1.2vw] font-bold py-[0.8vw] px-[3vw] rounded-full hover:bg-green-700 transition">
              Editar datos
            </button>
          </div>

          <!-- Modo Edici√≥n (oculto por defecto) -->
          <div *ngIf="modoEdicion" class="mt-[2vw] pt-[2vw] border-t-2 border-gray-200">
            <h3 class="text-[1.5vw] font-bold text-gray-800 mb-[1.5vw]">Editar Datos</h3>
            <form (ngSubmit)="guardarCambios()" class="space-y-[1vw]">
              
              <div>
                <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Nombre</label>
                <input [(ngModel)]="usuario.nombre" name="nombre" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
              </div>
              
              <div>
                <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Apellidos</label>
                <input [(ngModel)]="usuario.apellidos" name="apellidos" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
              </div>

              <div>
                <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">DNI / NIF</label>
                <input [(ngModel)]="usuario.dni" name="dni" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
              </div>

              <div>
                <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Tel√©fono</label>
                <input [(ngModel)]="usuario.telefono" name="telefono" type="tel" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
              </div>

              <div>
                <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Calle</label>
                <input [(ngModel)]="usuario.calle" name="calle" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
              </div>

              <div class="grid grid-cols-2 gap-[1vw]">
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">N√∫mero</label>
                  <input [(ngModel)]="usuario.numero" name="numero" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Piso/Puerta</label>
                  <input [(ngModel)]="usuario.pisoPuerta" name="pisoPuerta" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
              </div>

              <div class="grid grid-cols-2 gap-[1vw]">
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">C√≥digo Postal</label>
                  <input [(ngModel)]="usuario.codigoPostal" name="codigoPostal" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Ciudad</label>
                  <input [(ngModel)]="usuario.ciudad" name="ciudad" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
              </div>

              <div class="grid grid-cols-2 gap-[1vw]">
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Provincia</label>
                  <input [(ngModel)]="usuario.provincia" name="provincia" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
                <div>
                  <label class="block text-gray-700 font-bold text-[0.9vw] mb-[0.3vw]">Pa√≠s</label>
                  <input [(ngModel)]="usuario.pais" name="pais" type="text" class="w-full p-[0.6vw] text-[0.85vw] border border-gray-300 rounded-[0.5vw] bg-gray-50 focus:outline-none focus:border-green-600">
                </div>
              </div>

              <div class="flex gap-[1vw] pt-[1vw]">
                <button type="submit" [disabled]="isLoading" class="flex-1 bg-green-600 text-white text-[0.9vw] font-bold py-[0.6vw] rounded-[0.5vw] hover:bg-green-700 transition">
                  {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
                <button type="button" (click)="cancelarEdicion()" class="flex-1 bg-gray-400 text-white text-[0.9vw] font-bold py-[0.6vw] rounded-[0.5vw] hover:bg-gray-500 transition">
                  Cancelar
                </button>
              </div>
            </form>
          </div>

          <!-- Bot√≥n volver -->
          <div class="flex justify-center mt-[2vw]">
            <button 
              (click)="cambiarVista('menu')"
              class="text-green-700 font-bold hover:underline text-[1vw]">
              ‚Üê Volver al men√∫
            </button>
          </div>
        </div>
      </div>

      <!-- VISTA ENTRADAS -->
      <div *ngIf="vistaActual === 'tickets'" class="max-w-[70vw] pt-[3vw] mx-auto">
        <h1 class="text-green-900 text-[2.5vw] font-bold mb-[2vh] text-center">Mis Entradas</h1>

        <div class="flex justify-center mb-[2vw]">
          <button 
            (click)="cambiarVista('menu')"
            class="text-green-700 font-bold hover:underline text-[1vw]">
            ‚Üê Volver al men√∫
          </button>
        </div>
        
        <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-[5vw]">
          <div class="animate-spin rounded-full h-[3vw] w-[3vw] border-b-[0.4vw] border-green-600 mb-[1vw]"></div>
          <p class="text-green-800 text-[1vw] font-bold">Buscando tus entradas...</p>
        </div>

        <div *ngIf="!isLoading" class="animate-fade-in">
            
            <div *ngIf="tickets.length === 0" class="text-center text-[1.2vw] text-gray-600 bg-white p-[3vw] rounded-[1.5vw] shadow-lg">
              <p>No has adquirido ninguna entrada a√∫n. ¬°Ap√∫ntate a un evento!</p>
            </div>

            <div *ngIf="tickets.length > 0" class="grid gap-[1.5vw]">
              <div *ngFor="let ticket of tickets" class="bg-white p-[2vw] rounded-[1.5vw] shadow-lg border-l-4 border-green-600">
                <div class="flex flex-col gap-[0.4vw]">
                  <div class="flex items-center justify-between gap-[1vw] flex-wrap">
                    <h3 class="font-bold text-[1.3vw] text-gray-800">{{ ticket.eventoNombre || 'Evento' }}</h3>
                    <span class="inline-flex items-center gap-[0.5vw] bg-green-100 text-green-800 px-[1.2vw] py-[0.4vw] rounded-full text-[0.9vw] font-bold">
                      {{ ticket.tipoEntrada || 'Entrada' }}
                    </span>
                  </div>

                  <p class="text-gray-600 text-[1vw]">Fecha del evento: {{ ticket.fechaEvento | date:'dd/MM/yyyy' }}</p>
                  <p class="text-gray-600 text-[1vw]">Ubicaci√≥n: {{ ticket.ubicacion || 'Ubicaci√≥n pendiente' }}</p>
                  <p class="text-gray-600 text-[1vw]">Precio pagado: {{ ticket.precioPagado | currency:'EUR' }}</p>

                  <div class="flex items-center justify-between flex-wrap gap-[1vw] mt-[0.6vw]">
                    <span class="inline-flex items-center gap-[0.5vw] bg-green-50 text-green-700 px-[1.2vw] py-[0.5vw] rounded-full text-[0.9vw] font-semibold">
                      {{ ticket.estado || 'Activo' }}
                    </span>
                  </div>

                  <a *ngIf="ticket.codigoQrUrl" [href]="ticket.codigoQrUrl" target="_blank"
                    class="text-green-700 text-[0.95vw] font-semibold hover:underline mt-[0.4vw] inline-flex items-center gap-[0.4vw]">
                    Ver QR
                  </a>
                </div>
              </div>
            </div>

        </div>

      </div>

      <!-- VISTA DONACIONES -->
      <div *ngIf="vistaActual === 'donaciones'" class="max-w-[70vw] pt-[4vw] mx-auto">
        <h1 class="text-green-900 text-[2.5vw] font-bold mb-[2vh] text-center">Mi Historial Solidario</h1>
        
        <div class="flex justify-center mb-[2vw]">
          <button 
            (click)="cambiarVista('menu')"
            class="text-green-700 font-bold hover:underline text-[1vw]">
            ‚Üê Volver al men√∫
          </button>
        </div>

        <!-- Card de total -->
        <div class="bg-green-600 text-white p-[2vw] rounded-[1.5vw] shadow-lg mb-[2vw] text-center">
          <p class="text-[1.2vw] font-medium opacity-90">Total Donado</p>
          <p class="text-[3vw] font-bold">{{ totalDonado | currency:'EUR' }}</p>
        </div>

        <div *ngIf="donaciones.length === 0" class="text-center text-[1.2vw] text-gray-600 bg-white p-[3vw] rounded-[1.5vw] shadow-lg">
          <p>A√∫n no has realizado donaciones.</p>
        </div>

        <div class="bg-white rounded-[1.5vw] overflow-hidden shadow-lg">
          <table class="w-full text-left">
            <thead class="bg-gray-100 text-gray-700 uppercase text-[0.9vw] font-bold">
              <tr>
                <th class="p-[1.5vw]">Fecha</th>
                <th class="p-[1.5vw]">Concepto</th>
                <th class="p-[1.5vw] text-right">Cantidad</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <tr *ngFor="let donacion of donaciones" class="hover:bg-gray-50">
                <td class="p-[1.5vw] text-[0.95vw] text-gray-600">{{ donacion.fecha | date:'dd/MM/yyyy' }}</td>
                <td class="p-[1.5vw] text-[0.95vw] font-medium text-gray-800">{{ donacion.concepto || 'Donaci√≥n puntual' }}</td>
                <td class="p-[1.5vw] text-[0.95vw] text-right font-bold text-green-600">{{ donacion.amount || donacion.cantidad | currency:'EUR' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>

    </div>

  </div>
</section>